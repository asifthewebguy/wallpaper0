<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallpaper Viewer</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .api-link {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 14px;
            z-index: 10;
            transition: background-color 0.3s;
        }

        .api-link:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }
    </style>
</head>
<body>
    <div id="background-container" class="fullscreen-bg">
        <!-- Background image will be set via JavaScript -->
        <div id="loading-progress" class="loading-progress"></div>
        <div id="loading-text" class="loading-text">Loading image...</div>
    </div>

    <div class="controls">
        <button id="prev-btn">Previous</button>
        <button id="next-btn">Next</button>
        <button id="random-btn">Random</button>
    </div>

    <div class="info-panel">
        <p>Image ID: <span id="image-id">Loading...</span></p>
    </div>

    <a href="api/index.html" class="api-link">API Documentation</a>

    <!-- Load configuration -->
    <script src="config.js"></script>
    <!-- Load Google Drive proxy (inline for reliability) -->
    <script>
    /**
     * Simple Google Drive Image Proxy for GitHub Pages
     */
    window.GoogleDriveProxy = {
        extractFileId: function(url) {
            // Handle the export=view format
            if (url.includes('export=view&id=')) {
                const idParam = url.split('id=')[1];
                return idParam ? idParam.split('&')[0] : null;
            }

            // Handle the /file/d/ format
            const fileMatch = url.match(/\/file\/d\/([^/]+)/);
            if (fileMatch && fileMatch[1]) {
                return fileMatch[1];
            }

            // Handle the id= format
            const idMatch = url.match(/[?&]id=([^&]+)/);
            if (idMatch && idMatch[1]) {
                return idMatch[1];
            }

            return null;
        },

        loadImage: function(driveUrl) {
            return new Promise((resolve, reject) => {
                const fileId = this.extractFileId(driveUrl);

                if (!fileId) {
                    console.error('Could not extract file ID from URL:', driveUrl);
                    reject(new Error('Invalid Google Drive URL'));
                    return;
                }

                // Use the thumbnail API which has better CORS support
                const thumbnailUrl = 'https://drive.google.com/thumbnail?id=' + fileId + '&sz=w2000';
                console.log('Using Google Drive thumbnail API:', thumbnailUrl);
                resolve(thumbnailUrl);
            });
        }
    };
    </script>
    <!-- Load application -->
    <script src="js/github-pages-app.js"></script>
</body>
</html>
